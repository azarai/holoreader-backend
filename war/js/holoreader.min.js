$(document).ready(function(){function r(){var t=false;$("#devices :checkbox").each(function(){if($(this).is(":checked")){t=true;return false}});var n=false;$("#feeduploader "+e).each(function(){if($(this).val()){n=true;return false}});if(!t){$("#submit").prop("disabled",true);$("#submit").prop("value","Select at least one device");$("#submit").text("Select at least one device")}else if(!n){o()}else{if($("#submit").prop("disabled")){$("#submit").prop("disabled",false);$("#submit").prop("value","Send feeds to your device");$("#submit").text("Send feeds to your device")}}}function i(){s();u();o()}function s(e){if($("#error").css("opacity")=="1"){if(e){$("#error").css("opacity","0")}else{$("#error").animate({opacity:0},200)}}}function o(){$("#submit").prop("disabled",true);$("#submit").prop("value","Enter at least one URL");$("#submit").text("Enter at least one URL")}function u(){$("#devices :checkbox").each(function(){$(this).prop("checked",true)});if(t>1){f();a()}}function a(){$('<div class="control-group" style="display:none;"><input type="text" placeholder="e.g. http://rss.cnn.com/rss/edition.rss or just cnn.com" class="span8" name="feeds[]" id="feed_'+n+'"/></div>').appendTo("#inputs").slideDown("fast");n++;t++}function f(){$("#feeduploader "+e).each(function(){l($(this))})}function l(e){e.parent().slideUp("fast",function(){$(this).remove();t--})}function c(){var e=new Array;$("#devices :checkbox").each(function(){if($(this).is(":checked")){var t={};t["id"]=$(this).val();e.push(t)}});return e}function h(){var t=new Array;$("#feeduploader "+e).each(function(){var e=$(this).val();if(e!=""&&$(this).prop("disabled")!=true){var n={};n["url"]=e;n["inputid"]=$(this).attr("id");t.push(n)}});return t}function p(e,t,n){$.each(e,function(e,t){if(t==true){$("#"+e).prop("disabled",true);$("#"+e).parent().removeClass("error");$("#"+e).parent().addClass("success")}else{$("#"+e).parent().addClass("error");if($("#error").css("opacity")=="0"){$("#error").animate({opacity:1},200)}}});$("#submit").button("reset");$("#clear").prop("disabled",false)}function d(e,t,n){alert("Something went terribly wrong.\n"+n);$("#submit").button("reset");$("#clear").prop("disabled",false)}var e=":input:not(:button):not(:checkbox)";var t=$("#feeduploader "+e).length;var n=t+1;$("#feeduploader").on("blur",e,function(t){var n=0;$("#feeduploader "+e).each(function(){if(!$(this).val()){n++}});if(!$(this).val()&&n>1){l($(this))}r()});$("#feeduploader").on("keyup",e,function(t){var n=false;$("#feeduploader "+e).each(function(){if(!$(this).val()){n=true;return false}});if(!n){a()}r()});$("#devices :checkbox").click(function(){r()});$("#clear").click(function(){i();return false});$("#submit").click(function(){$(this).button("loading");$("#clear").prop("disabled",true);s(true);var e={};e["devices"]=c();e["feeds"]=h();$.ajax({type:"POST",url:"/",contentType:"application/json",data:JSON.stringify(e),processData:false,dataType:"json",success:p,error:d});return false})})